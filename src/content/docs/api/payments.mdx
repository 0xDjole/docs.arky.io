---
title: Payments API
description: Quote engine, markets, Stripe, and promo codes
head: []
---

import Tabs from '../../../components/Tabs.svelte';

Payment processing, quote calculation, markets configuration, and promo code management.

## Base URL

- Quote: `/v1/payments`
- Markets: `/v1/payments/businesses/{businessId}/markets`
- Promo Codes: `/v1/businesses/{businessId}/promo-codes`

## Authentication

Requires `Authorization: Bearer <access_token>` for management. Quote endpoint can be used with guest tokens.

---

## Quote Engine

Calculate total price including tax, shipping, and discounts.

**Endpoint:** `POST /v1/payments/quote`

<Tabs client:load>
  <div slot="tab1">

```typescript
const quote = await sdk.eshop.getQuote({
  currency: 'USD',
  paymentMethod: 'CREDIT_CARD',
  items: [
    {
      productId: 'prod_abc123',
      variantId: 'variant_small_red',
      quantity: 2,
    },
  ],
  shippingMethodId: 'shipping_standard',
  promoCode: 'SUMMER20',
});

console.log('Subtotal:', quote.subtotal);
console.log('Tax:', quote.tax, `(${quote.taxBps / 100}%)`);
console.log('Shipping:', quote.shipping);
console.log('Discount:', quote.discount);
console.log('Total:', quote.total);
```

  </div>
  <div slot="tab2">

```bash
curl -X POST https://api.arky.io/v1/payments/quote \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "businessId": "YOUR_BUSINESS_ID",
    "market": "US",
    "currency": "USD",
    "paymentMethod": "CREDIT_CARD",
    "lines": [
      {
        "type": "PRODUCT_VARIANT",
        "productId": "prod_abc123",
        "variantId": "variant_small_red",
        "quantity": 2
      }
    ],
    "shippingMethodId": "shipping_standard",
    "promoCode": "SUMMER20"
  }'
```

  </div>
</Tabs>

**Response:**

```json
{
  "lines": [
    {
      "type": "PRODUCT_VARIANT",
      "productId": "prod_abc123",
      "variantId": "variant_small_red",
      "quantity": 2,
      "unitPrice": 2999,
      "totalPrice": 5998
    }
  ],
  "subtotal": 5998,
  "tax": 420,
  "taxBps": 700,
  "shipping": 500,
  "discount": 600,
  "total": 6318,
  "currency": "USD"
}
```

**Line Types:**
- `PRODUCT_VARIANT`: E-commerce product
- `SERVICE`: Reservation service
- `SHIPPING`: Shipping fee
- `TAX`: Tax amount
- `DISCOUNT`: Promo code discount

---

## Markets

### Get Markets

**Endpoint:** `GET /v1/payments/businesses/{businessId}/markets`

<Tabs client:load>
  <div slot="tab1">

```typescript
const markets = await sdk.payment.getBusinessMarkets({});

markets.forEach((market) => {
  console.log('Market:', market.id);
  console.log('Currency:', market.currency);
  console.log('Tax:', `${market.taxBps / 100}%`);
  console.log('Tax Mode:', market.taxMode); // INCLUSIVE or EXCLUSIVE
});
```

  </div>
  <div slot="tab2">

```bash
curl https://api.arky.io/v1/payments/businesses/YOUR_BUSINESS_ID/markets \
  -H "Authorization: Bearer YOUR_TOKEN"
```

  </div>
</Tabs>

**Response:**

```json
[
  {
    "id": "US",
    "currency": "USD",
    "taxMode": "EXCLUSIVE",
    "taxBps": 700,
    "paymentMethods": [
      { "method": "CREDIT_CARD" },
      { "method": "BANK_TRANSFER" }
    ],
    "shippingMethods": [
      {
        "id": "standard",
        "name": "Standard Shipping",
        "price": 500,
        "estimatedDays": 5
      }
    ]
  }
]
```

---

### Get Market

**Endpoint:** `GET /v1/payments/businesses/{businessId}/markets/{marketId}`

<Tabs client:load>
  <div slot="tab1">

```typescript
const market = await sdk.payment.getBusinessMarket({
  marketId: 'US',
});
```

  </div>
  <div slot="tab2">

```bash
curl https://api.arky.io/v1/payments/businesses/YOUR_BUSINESS_ID/markets/US \
  -H "Authorization: Bearer YOUR_TOKEN"
```

  </div>
</Tabs>

---

## Promo Codes

### Create Promo Code

**Endpoint:** `POST /v1/businesses/{businessId}/promo-codes`

<Tabs client:load>
  <div slot="tab1">

```typescript
const promoCode = await sdk.promoCode.createPromoCode({
  code: 'SUMMER20',
  discountType: 'PERCENTAGE', // or 'FIXED'
  discountValue: 2000, // 20% (in basis points) or cents for FIXED
  maxUses: 100,
  usesCount: 0,
  expiresAt: Math.floor(Date.now() / 1000) + 30 * 24 * 3600, // 30 days
  minPurchaseAmount: 5000, // Minimum $50 order
  applicableToTypes: ['PRODUCT_VARIANT', 'SERVICE'],
  statuses: [
    {
      id: 'status_1',
      status: 'ACTIVE',
      changedBy: 'USER',
      timestamp: Date.now() / 1000,
    },
  ],
});
```

  </div>
  <div slot="tab2">

```bash
curl -X POST https://api.arky.io/v1/businesses/YOUR_BUSINESS_ID/promo-codes \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "code": "SUMMER20",
    "discountType": "PERCENTAGE",
    "discountValue": 2000,
    "maxUses": 100,
    "usesCount": 0,
    "expiresAt": 1730000000,
    "minPurchaseAmount": 5000,
    "applicableToTypes": ["PRODUCT_VARIANT", "SERVICE"],
    "statuses": [...]
  }'
```

  </div>
</Tabs>

---

### Get Promo Codes

**Endpoint:** `GET /v1/businesses/{businessId}/promo-codes`

<Tabs client:load>
  <div slot="tab1">

```typescript
const { items, cursor } = await sdk.promoCode.getPromoCodes({
  limit: 20,
  cursor: null,
});
```

  </div>
  <div slot="tab2">

```bash
curl "https://api.arky.io/v1/businesses/YOUR_BUSINESS_ID/promo-codes?limit=20" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

  </div>
</Tabs>

---

### Get Promo Code

**Endpoint:** `GET /v1/businesses/{businessId}/promo-codes/{id}`

<Tabs client:load>
  <div slot="tab1">

```typescript
const promoCode = await sdk.promoCode.getPromoCode({
  id: 'promo_abc123',
});
```

  </div>
  <div slot="tab2">

```bash
curl https://api.arky.io/v1/businesses/YOUR_BUSINESS_ID/promo-codes/PROMO_ID \
  -H "Authorization: Bearer YOUR_TOKEN"
```

  </div>
</Tabs>

---

### Update Promo Code

**Endpoint:** `PUT /v1/businesses/{businessId}/promo-codes/{id}`

<Tabs client:load>
  <div slot="tab1">

```typescript
const updated = await sdk.promoCode.updatePromoCode({
  id: 'promo_abc123',
  maxUses: 200,
  expiresAt: Math.floor(Date.now() / 1000) + 60 * 24 * 3600, // Extend 60 days
});
```

  </div>
  <div slot="tab2">

```bash
curl -X PUT https://api.arky.io/v1/businesses/YOUR_BUSINESS_ID/promo-codes/PROMO_ID \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{ "maxUses": 200, "expiresAt": 1735000000 }'
```

  </div>
</Tabs>

---

### Delete Promo Code

**Endpoint:** `DELETE /v1/businesses/{businessId}/promo-codes/{id}`

<Tabs client:load>
  <div slot="tab1">

```typescript
await sdk.promoCode.deletePromoCode({
  id: 'promo_abc123',
});
```

  </div>
  <div slot="tab2">

```bash
curl -X DELETE https://api.arky.io/v1/businesses/YOUR_BUSINESS_ID/promo-codes/PROMO_ID \
  -H "Authorization: Bearer YOUR_TOKEN"
```

  </div>
</Tabs>

---

## Stripe Webhooks

Handle Stripe webhook events.

**Endpoint:** `POST /v1/payments/webhooks/stripe`

<Tabs client:load>
  <div slot="tab1">

```typescript
// This is handled by Stripe
// Configure webhook URL in Stripe Dashboard:
// https://yourdomain.com/api/webhooks/stripe

await sdk.payment.handleStripeWebhook({
  event: stripeEvent, // From Stripe
  signature: req.headers['stripe-signature'],
});
```

  </div>
  <div slot="tab2">

```bash
# Stripe sends webhook to your endpoint
curl -X POST https://api.arky.io/v1/payments/webhooks/stripe \
  -H "Stripe-Signature: SIGNATURE" \
  -H "Content-Type: application/json" \
  -d '{ ...stripe event... }'
```

  </div>
</Tabs>

**Handled Events:**
- `checkout.session.completed`: Order/reservation payment complete
- `customer.subscription.created`: Newsletter subscription started
- `customer.subscription.updated`: Subscription status changed
- `customer.subscription.deleted`: Subscription cancelled

---

## Tax Calculation

**Tax Modes:**

- `EXCLUSIVE`: Tax added on top of price (US-style)
- `INCLUSIVE`: Tax included in price (EU-style)

**Tax Rate:** Stored as basis points (bps)
- `700 bps` = 7%
- `1950 bps` = 19.5%

**Example:**

```typescript
// EXCLUSIVE tax (US)
const subtotal = 5000; // $50.00
const taxBps = 700;    // 7%
const tax = (subtotal * taxBps) / 10000;
const total = subtotal + tax; // $53.50

// INCLUSIVE tax (EU)
const priceWithTax = 5000; // â‚¬50.00 (includes 19% VAT)
const taxBps = 1900;
const tax = (priceWithTax * taxBps) / (10000 + taxBps);
const subtotal = priceWithTax - tax;
```

---

## Discount Types

**PERCENTAGE:**
```typescript
{
  discountType: 'PERCENTAGE',
  discountValue: 1500, // 15% in basis points
}
```

Calculation: `discount = (subtotal * 1500) / 10000`

**FIXED:**
```typescript
{
  discountType: 'FIXED',
  discountValue: 1000, // $10.00 in cents
}
```

Calculation: `discount = 1000` (flat amount)

---

## Related

- **[E-shop API: Checkout](/api/eshop/#checkout-flow)**
- **[Reservations API: Checkout](/api/reservations/#checkout-flow)**
- **[Business API: Markets](/api/business/)**: Configure markets
- **[Core Concepts: Markets](/core-concepts/#markets--zones)**
